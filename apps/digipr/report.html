<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DigiPR- Digital Personal Register | Report</title>
    
    <!-- Bootstrap & DataTables CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css">
    
    <!-- jQuery UI Datepicker -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css">
    
    <!-- jsPDF and html2canvas for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        body {
            background-color: #d7e2ff6e;
            min-width: 100%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: none;
            margin-bottom: 20px;
        }
		.d-header {
    background: linear-gradient(to right, var(--primary-color), var(--secondary-color));
    color: white;
    padding: 15px 20px;
    border-radius: 10px 10px 0 0 !important;
}
        .loading {
            display: none;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            padding: 20px;
        }
        .select2-container .select2-selection--single {
            height: 37px !important;
            padding: 5px 10px;
            border: 1px solid #ced4da;
            border-radius: 5px;
        }
        .select2-container .select2-selection__rendered {
            line-height: 28px !important;
        }
        .select2-container .select2-selection__arrow {
            height: 36px !important;
        }
        h5 {
            color: #5f87c5;
            font-weight: 600;
        }
        .table-container {
            overflow-x: auto;
        }
        .dataTables_wrapper {
            margin-top: 15px;
        }
        .total-row {
            background-color: #f8f9fa;
            font-weight: bold;
        }
        .filter-card {
            background-color: #f8f9fa;
        }
        .btn-primary {
            background-color: #5f87c5;
            border-color: #5f87c5;
        }
        .btn-primary:hover {
            background-color: #4a6da7;
            border-color: #4a6da7;
        }
        .btn-export {
            background-color: #28a745;
            border-color: #28a745;
            color: white;
        }
        .btn-export:hover {
            background-color: #218838;
            border-color: #1e7e34;
        }
        #resultHeading {
            color: #5f87c5;
            margin-bottom: 10px;
        }
        #recordCount {
            font-size: 14px;
            color: #ff0000;
            font-weight: normal;
        }
        .header-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        table.dataTable thead th {
            border-bottom: 2px solid #5f87c5;
            background-color: #f1f5fd;
        }
        table.dataTable tbody tr:hover {
            background-color: #f0f4ff;
        }
        .datepicker {
            background-color: white;
            cursor: pointer;
        }
        .required-field {
            border: 1px solid #dc3545 !important;
        }
        .form-label.required::after {
            content: " *";
            color: #dc3545;
        }
        .no-data-message {
            text-align: center;
            padding: 40px;
            color: #6c757d;
            font-style: italic;
        }
        .btn-export:disabled {
            background-color: #6c757d;
            border-color: #6c757d;
            cursor: not-allowed;
        }
    </style>
</head>
<body class="container py-4">
    <div class="card p-4 filter-card">
        <h5>DigiPR- Digital Personal Register | Report</h5>
        <hr>
        <div class="row g-3">
            <div class="col-md-3">
                <label for="treasuryCode" class="form-label required">Treasury Code:</label>
                <select id="treasuryCode" class="form-control select2" required>
                    <option value="">Select Treasury Code</option>
                    <!-- Will be populated from Google Sheets -->
                </select>
            </div>
            <div class="col-md-3">
                <label for="section" class="form-label required">Section:</label>
                <select id="section" class="form-control select2" required>
                    <option value="">Select Section</option>
                    <!-- Will be populated from Google Sheets -->
                </select>
            </div>
            <div class="col-md-2">
                <label for="fromDate" class="form-label required">From Date:</label>
                <input type="text" id="fromDate" class="form-control datepicker" placeholder="DD/MM/YYYY" required>
            </div>
            <div class="col-md-2">
                <label for="toDate" class="form-label required">To Date:</label>
                <input type="text" id="toDate" class="form-control datepicker" placeholder="DD/MM/YYYY" required>
            </div>
            <div class="col-md-2 d-flex align-items-end">
                <button class="btn btn-primary w-100" onclick="validateAndLoadData()">View Report</button>
            </div>
        </div>
    </div>

    <div class="loading mt-3" id="loading">
        <img src="https://itcelldto.github.io/try/Spinner-3.gif" alt="Loading..." style="height: 40px;">
        <div>Loading. Please wait...</div>
    </div>

    <div class="card p-4" id="resultsCard" style="display: none;">
        <div class="header-actions">
            <h5 id="resultHeading">DigiPR- Digital Personal Register | Report Details <span id="recordCount"></span></h5>
            <button class="btn btn-export" onclick="exportToPDF()" id="exportBtn" disabled>
                <i class="bi bi-file-pdf"></i> Export to PDF
            </button>
        </div>
        <hr>
        <div class="table-container">
            <table id="reportTable" class="table table-striped table-bordered" style="width:100%">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Treasury Code</th>
                        <th>Section</th>
                        <th>SL.No</th>
                        <th>Current No</th>
                        <th>Date of Receipt by clerk</th>
                        <th>Title</th>
                        <th>From Whom Outside no</th>
                        <th>Date</th>
                        <th>Submitted by Clerk</th>
                        <th>Returned to clerk</th>
                        <th>Reference issued to whom</th>
                        <th>Reference issued date</th>
                        <th>Replay or fresh Current received from whom and number</th>
                        <th>Received date</th>
                        <th>Date of receipt by clerk</th>
                        <th>Nature of Disposal</th>
                        <th>Date of disposal</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Data will be populated here -->
                </tbody>
                <tfoot>
                    <tr class="total-row">
                        <td colspan="17" class="text-end fw-bold">Total Records:</td>
                        <td id="totalRecords" class="fw-bold" style="color:green">0</td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <!-- jQuery, Bootstrap, DataTables, SweetAlert, Select2 -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
    
    <!-- jQuery UI Datepicker -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

    <script>
        // Google Sheets configuration
        const SHEET_ID = "1W3SlfTY_139CAyId57CDFV_BDgAadxED83D_2N1mNR8";
        const SHEET_NAME = "DB";
        const API_KEY = "AIzaSyBAuS3Brpsw5JOJnjNJii1UlFa7ClXf8d4";
        
        let dataTable = null;
        let allUniqueTreasuryCodes = [];
        let allUniqueSections = [];
        let currentFilterCriteria = null;
        let currentDataForExport = []; // Store current data for export
        
        $(document).ready(function() {
            // Initialize datepicker
            $(".datepicker").datepicker({
                dateFormat: "dd/mm/yy",
                changeMonth: true,
                changeYear: true,
                yearRange: "c-10:c+10"
            });
            
            // Set default dates (last 30 days)
            setDefaultDates();
            
            // Initialize Select2
            $('.select2').select2();
            
            // Load filter options from Google Sheets
            loadFilterOptions();
            
            // Add validation on input change
            $('#treasuryCode, #section, #fromDate, #toDate').on('change', function() {
                validateField($(this));
                
                // Clear results when any filter changes
                clearResults();
            });
        });
        
        function setDefaultDates() {
            const today = new Date();
            const lastMonth = new Date(today);
            lastMonth.setDate(today.getDate() - 30);
            
            // Format today as DD/MM/YYYY
            const toDateStr = `${String(today.getDate()).padStart(2, '0')}/${String(today.getMonth() + 1).padStart(2, '0')}/${today.getFullYear()}`;
            
            // Format last month as DD/MM/YYYY
            const fromDateStr = `${String(lastMonth.getDate()).padStart(2, '0')}/${String(lastMonth.getMonth() + 1).padStart(2, '0')}/${lastMonth.getFullYear()}`;
            
            $('#toDate').val(toDateStr);
            $('#fromDate').val(fromDateStr);
        }
        
        function loadFilterOptions() {
            showLoading(true);
            
            // We only need columns B and C for the filter options
            const range = `${SHEET_NAME}!B:C`;
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${range}?key=${API_KEY}`;
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const rows = data.values || [];
                    
                    if (rows.length === 0) {
                        Swal.fire('Error', 'No data found in the sheet', 'error');
                        showLoading(false);
                        return;
                    }
                    
                    // Skip header row
                    const dataRows = rows.slice(1);
                    
                    // Extract unique values
                    allUniqueTreasuryCodes = [...new Set(dataRows.map(row => row[0] || '').filter(Boolean))].sort();
                    allUniqueSections = [...new Set(dataRows.map(row => row[1] || '').filter(Boolean))].sort();
                    
                    // Populate filter dropdowns
                    populateFilterDropdowns();
                    
                    showLoading(false);
                })
                .catch(error => {
                    console.error("Error fetching filter options:", error);
                    Swal.fire('Error', 'Failed to load filter options from Google Sheets', 'error');
                    showLoading(false);
                });
        }
        
        function populateFilterDropdowns() {
            const treasurySelect = $('#treasuryCode');
            const sectionSelect = $('#section');
            
            // Clear existing options except the first one
            treasurySelect.find('option:not(:first)').remove();
            sectionSelect.find('option:not(:first)').remove();
            
            // Add unique treasury codes
            allUniqueTreasuryCodes.forEach(code => {
                treasurySelect.append(`<option value="${code}">${code}</option>`);
            });
            
            // Add unique sections
            allUniqueSections.forEach(section => {
                sectionSelect.append(`<option value="${section}">${section}</option>`);
            });
            
            // Refresh Select2
            treasurySelect.trigger('change.select2');
            sectionSelect.trigger('change.select2');
        }
        
        function clearResults() {
            // Hide results card
            $('#resultsCard').hide();
            
            // Clear table data
            $('#tableBody').empty();
            
            // Reset DataTable if it exists
            if (dataTable) {
                dataTable.destroy();
                dataTable = null;
            }
            
            // Reset counters
            $('#totalRecords').text('0');
            $('#recordCount').text('');
            
            // DO NOT reset current filter criteria and data when just changing filters
            // We only reset them when explicitly loading new data
            
            // Disable export button when no data
            $('#exportBtn').prop('disabled', true);
        }
        
        function validateAndLoadData() {
            // Validate all required fields
            const treasuryCode = $('#treasuryCode').val();
            const section = $('#section').val();
            const fromDate = $('#fromDate').val();
            const toDate = $('#toDate').val();
            
            let isValid = true;
            
            // Validate each field
            if (!treasuryCode) {
                $('#treasuryCode').addClass('required-field');
                isValid = false;
            } else {
                $('#treasuryCode').removeClass('required-field');
            }
            
            if (!section) {
                $('#section').addClass('required-field');
                isValid = false;
            } else {
                $('#section').removeClass('required-field');
            }
            
            if (!fromDate) {
                $('#fromDate').addClass('required-field');
                isValid = false;
            } else {
                $('#fromDate').removeClass('required-field');
            }
            
            if (!toDate) {
                $('#toDate').addClass('required-field');
                isValid = false;
            } else {
                $('#toDate').removeClass('required-field');
            }
            
            if (!isValid) {
                Swal.fire('Validation Error', 'Please fill all required fields marked with *', 'error');
                return;
            }
            
            // Validate date format and logic
            if (!isValidDate(fromDate) || !isValidDate(toDate)) {
                Swal.fire('Date Error', 'Please enter valid dates in DD/MM/YYYY format', 'error');
                return;
            }
            
            const fromDateObj = parseDate(fromDate);
            const toDateObj = parseDate(toDate);
            
            if (fromDateObj > toDateObj) {
                Swal.fire('Date Error', 'From Date cannot be greater than To Date', 'error');
                return;
            }
            
            // Check if same criteria are already loaded
            const newCriteria = { treasuryCode, section, fromDate, toDate };
            if (currentFilterCriteria && 
                currentFilterCriteria.treasuryCode === newCriteria.treasuryCode &&
                currentFilterCriteria.section === newCriteria.section &&
                currentFilterCriteria.fromDate === newCriteria.fromDate &&
                currentFilterCriteria.toDate === newCriteria.toDate) {
                
                // Same criteria, no need to reload
                return;
            }
            
            // Store current criteria
            currentFilterCriteria = newCriteria;
            
            // All validations passed, load data
            loadDataByCriteria(treasuryCode, section, fromDateObj, toDateObj);
        }
        
        function validateField(field) {
            if (field.val()) {
                field.removeClass('required-field');
            }
        }
        
        function isValidDate(dateStr) {
            const pattern = /^(\d{2})\/(\d{2})\/(\d{4})$/;
            if (!pattern.test(dateStr)) return false;
            
            const parts = dateStr.split('/');
            const day = parseInt(parts[0], 10);
            const month = parseInt(parts[1], 10);
            const year = parseInt(parts[2], 10);
            
            if (month < 1 || month > 12) return false;
            
            const date = new Date(year, month - 1, day);
            return date.getDate() === day && 
                   date.getMonth() === month - 1 && 
                   date.getFullYear() === year;
        }
        
        function parseDate(dateStr) {
            const parts = dateStr.split('/');
            return new Date(parts[2], parts[1] - 1, parts[0]);
        }
        
        function loadDataByCriteria(treasuryCode, section, fromDate, toDate) {
            showLoading(true);
            
            // Clear any existing results first
            clearResults();
            
            // Adjust date range for inclusive search
            const searchFromDate = new Date(fromDate);
            searchFromDate.setHours(0, 0, 0, 0);
            
            const searchToDate = new Date(toDate);
            searchToDate.setHours(23, 59, 59, 999);
            
            // Load all data and filter locally
            const range = `${SHEET_NAME}!A:R`;
            const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${range}?key=${API_KEY}`;
            
            fetch(url)
                .then(response => response.json())
                .then(data => {
                    const rows = data.values || [];
                    
                    if (rows.length === 0) {
                        showLoading(false);
                        Swal.fire('No Data', 'No data found in the sheet', 'info');
                        return;
                    }
                    
                    // Get headers
                    const headers = rows[0];
                    
                    // Process and filter data
                    const filteredData = rows.slice(1).filter(row => {
                        // Check if row has enough columns
                        if (row.length < 6) return false;
                        
                        // Treasury Code filter (Column B, index 1)
                        if (row[1] !== treasuryCode) return false;
                        
                        // Section filter (Column C, index 2)
                        if (row[2] !== section) return false;
                        
                        // Date filter - Date of Receipt by clerk (Column F, index 5)
                        const receiptDateStr = row[5];
                        if (!receiptDateStr) return false;
                        
                        const receiptDate = parseDate(receiptDateStr);
                        if (receiptDate < searchFromDate || receiptDate > searchToDate) {
                            return false;
                        }
                        
                        return true;
                    }).map(row => {
                        const obj = {};
                        headers.forEach((header, index) => {
                            obj[header] = row[index] || '';
                        });
                        return obj;
                    });
                    
                    // Store current data for export
                    currentDataForExport = filteredData;
                    
                    // Display filtered data
                    displayData(filteredData, treasuryCode, section, fromDate, toDate);
                    
                    showLoading(false);
                })
                .catch(error => {
                    console.error("Error fetching data:", error);
                    Swal.fire('Error', 'Failed to load data from Google Sheets', 'error');
                    showLoading(false);
                });
        }
        
        function displayData(data, treasuryCode, section, fromDate, toDate) {
            const tableBody = $('#tableBody');
            tableBody.empty();
            
            if (data.length === 0) {
                // Show no data message
                const noDataRow = `
                    <tr>
                        <td colspan="18" class="text-center no-data-message">
                            <div style="font-size: 16px; margin-bottom: 10px;">ðŸ“­</div>
                            <div>No records found for the selected criteria.</div>
                            <div style="font-size: 12px; margin-top: 10px;">
                                Treasury Code: <strong>${treasuryCode}</strong> | 
                                Section: <strong>${section}</strong> | 
                                Date Range: <strong>${formatDateForDisplay(fromDate)} to ${formatDateForDisplay(toDate)}</strong>
                            </div>
                        </td>
                    </tr>
                `;
                tableBody.append(noDataRow);
                
                // Still show results card but with no data
                $('#resultsCard').show();
                $('#resultHeading').html(`DigiPR Report Details <span id="recordCount" style="color: red;">(0 records found)</span>`);
                $('#totalRecords').text('0');
                
                // Disable export button when no data
                $('#exportBtn').prop('disabled', true);
                
                // Clear export data
                currentDataForExport = [];
                
                Swal.fire('No Records', 'No records found for the selected criteria.', 'info');
                return;
            }
            
            // Enable export button
            $('#exportBtn').prop('disabled', false);
            
            // Populate table
            data.forEach((item, index) => {
                const row = `
                    <tr>
                        <td>${item['ID'] || ''}</td>
                        <td>${item['Treasury Code'] || ''}</td>
                        <td>${item['Section'] || ''}</td>
                        <td>${item['SL.No'] || ''}</td>
                        <td>${item['Current No'] || ''}</td>
                        <td>${item['Date of Receipt by clerk'] || ''}</td>
                        <td>${item['Title'] || ''}</td>
                        <td>${item['From Whom  Outside no'] || ''}</td>
                        <td>${item['date'] || ''}</td>
                        <td>${item['Submitted by Clerk'] || ''}</td>
                        <td>${item['Returned to clerk'] || ''}</td>
                        <td>${item['Reference issued to whom'] || ''}</td>
                        <td>${item['reference issued date'] || ''}</td>
                        <td>${item['Replay or fresh Current received from whom and number'] || ''}</td>
                        <td>${item['received date'] || ''}</td>
                        <td>${item['Date of receipt by clerk'] || ''}</td>
                        <td>${item['Nature of Disposal'] || ''}</td>
                        <td>${item['Date of disposal'] || ''}</td>
                    </tr>
                `;
                tableBody.append(row);
            });
            
            // Update header with filter criteria
            const fromDateStr = formatDateForDisplay(fromDate);
            const toDateStr = formatDateForDisplay(toDate);
            
            $('#resultHeading').html(`
DigiPR Report - ${treasuryCode} / ${section}
                <span id="recordCount" style="color: green; font-size: 12px;">
                    (${data.length} records from ${fromDateStr} to ${toDateStr})
                </span>
            `);
            
            $('#totalRecords').text(data.length);
            
            // Show results card
            $('#resultsCard').show();
            
            // Initialize or reinitialize DataTable
            if (dataTable) {
                dataTable.destroy();
            }
            
            dataTable = $('#reportTable').DataTable({
                paging: true,
                pageLength: 10,
                lengthMenu: [10, 25, 50, 100],
                searching: true,
                ordering: true,
                responsive: true,
                scrollX: true,
                dom: '<"row"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6"f>>tip',
                language: {
                    search: "Search within results:",
                    lengthMenu: "Show _MENU_ entries",
                    info: "Showing _START_ to _END_ of _TOTAL_ entries",
                    paginate: {
                        first: "First",
                        last: "Last",
                        next: "Next",
                        previous: "Previous"
                    }
                },
                drawCallback: function(settings) {
                    // Update total records count after each draw
                    const api = this.api();
                    $('#totalRecords').text(api.rows({ filter: 'applied' }).count());
                }
            });
            
            // Scroll to results
            $('html, body').animate({
                scrollTop: $('#resultsCard').offset().top - 20
            }, 500);
        }
        
        function formatDateForDisplay(date) {
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();
            return `${day}/${month}/${year}`;
        }
        
        function exportToPDF() {
            // Debug: Check what data we have
            console.log("Exporting PDF...");
            console.log("currentFilterCriteria:", currentFilterCriteria);
            console.log("currentDataForExport length:", currentDataForExport.length);
            
            // Check if we have data to export
            if (!currentFilterCriteria || currentDataForExport.length === 0) {
                console.log("No data available for export");
                Swal.fire('No Data', 'No data available to export. Please load data first by clicking "View Report".', 'warning');
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                orientation: 'landscape',
                unit: 'mm',
                format: 'a4'
            });
            
            // Get filter criteria
            const { treasuryCode, section, fromDate, toDate } = currentFilterCriteria;
            
            // Prepare table data for PDF
            const headers = [
                ['ID', 'Treasury', 'Section', 'SL.No', 'Current No', 
                 'Date of Receipt', 'Title', 'From Whom', 'Date',
                 'Submitted by', 'Returned to', 'Reference to', 'Ref Date',
                 'Replay/Fresh', 'Received Date', 'Receipt Date', 
                 'Nature of Disposal', 'Disposal Date']
            ];
            
            const tableData = currentDataForExport.map(item => {
                return [
                    item['ID'] || '',
                    item['Treasury Code'] || '',
                    item['Section'] || '',
                    item['SL.No'] || '',
                    item['Current No'] || '',
                    item['Date of Receipt by clerk'] || '',
                    item['Title'] || '',
                    item['From Whom  Outside no'] || '',
                    item['date'] || '',
                    item['Submitted by Clerk'] || '',
                    item['Returned to clerk'] || '',
                    item['Reference issued to whom'] || '',
                    item['reference issued date'] || '',
                    item['Replay or fresh Current received from whom and number'] || '',
                    item['received date'] || '',
                    item['Date of receipt by clerk'] || '',
                    item['Nature of Disposal'] || '',
                    item['Date of disposal'] || ''
                ];
            });
            
            // Add title and filter info
            doc.setFontSize(16);
            doc.text('DigiPR Report', 14, 15);
            
            doc.setFontSize(10);
            doc.text(`Generated on: ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString()}`, 14, 22);
            
            // Filter criteria
            let criteriaY = 28;
            doc.setFontSize(10);
            doc.text('Filter Criteria:', 14, criteriaY);
            criteriaY += 5;
            doc.text(`Treasury Code: ${treasuryCode}`, 14, criteriaY);
            criteriaY += 5;
            doc.text(`Section: ${section}`, 14, criteriaY);
            criteriaY += 5;
            doc.text(`Date Range: ${fromDate} to ${toDate}`, 14, criteriaY);
            criteriaY += 5;
            doc.text(`Total Records: ${currentDataForExport.length}`, 14, criteriaY);
            
            // Create table
            doc.autoTable({
                head: headers,
                body: tableData,
                startY: criteriaY + 5,
                theme: 'grid',
                styles: {
                    fontSize: 6,
                    cellPadding: 2,
                    overflow: 'linebreak'
                },
                headStyles: {
                    fillColor: [95, 135, 197], // #5f87c5
                    textColor: 255,
                    fontSize: 7,
                    fontStyle: 'bold'
                },
                alternateRowStyles: {
                    fillColor: [247, 247, 247]
                },
                margin: { left: 14, right: 14 },
                tableWidth: 'auto',
                columnStyles: {
                    0: { cellWidth: 10 },
                    1: { cellWidth: 20 },
                    2: { cellWidth: 15 },
                    3: { cellWidth: 10 },
                    4: { cellWidth: 15 },
                    5: { cellWidth: 15 },
                    6: { cellWidth: 25 },
                    7: { cellWidth: 20 },
                    8: { cellWidth: 15 },
                    9: { cellWidth: 20 },
                    10: { cellWidth: 20 },
                    11: { cellWidth: 20 },
                    12: { cellWidth: 15 },
                    13: { cellWidth: 25 },
                    14: { cellWidth: 15 },
                    15: { cellWidth: 15 },
                    16: { cellWidth: 20 },
                    17: { cellWidth: 15 }
                }
            });
            
            // Save PDF
            const fileName = `Digi_PR_${treasuryCode}_${section}_${fromDate.replace(/\//g, '-')}_to_${toDate.replace(/\//g, '-')}.pdf`;
            doc.save(fileName);
            
            // Show success message
            Swal.fire({
                title: 'PDF Exported',
                text: `Report has been exported as ${fileName}`,
                icon: 'success',
                timer: 3000,
                showConfirmButton: false
            });
        }
        
        function showLoading(show) {
            if (show) {
                $('#loading').show();
            } else {
                $('#loading').hide();
            }
        }
    </script>
</body>
</html>
