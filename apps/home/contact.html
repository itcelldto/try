<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Treasury Contact Details</title>
    
    <!-- Bootstrap & DataTables CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    
    <!-- jQuery, Bootstrap, DataTables -->
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

    <style>
        body {
            background-color: #d7e2ff6e;
            min-width: 100%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .container.py-4 {
            padding-top: 1.5rem !important;
            padding-bottom: 1.5rem !important;
        }
        
        .card {
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            border: 1px solid rgba(0, 0, 0, 0.125);
            border-radius: 8px;
        }
        
        .card-header {
            background-color: #5f87c5;
            color: white;
            border-radius: 8px 8px 0 0 !important;
            padding: 15px 20px;
            border-bottom: 1px solid rgba(0,0,0,.125);
        }
        
        .card-header h5 {
            margin: 0;
            font-weight: 600;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            font-style: italic;
            color: #7f8c8d;
        }
        
        .error {
            color: #e74c3c;
            text-align: center;
            padding: 20px;
            font-weight: bold;
        }
        
        /* Email styling - light blue and clickable */
        .email-link {
            color: #3498db !important;
            text-decoration: none;
            font-weight: 500;
        }
        
        .email-link:hover {
            color: #2980b9 !important;
            text-decoration: underline;
        }
        
        /* Phone styling - red for office, green for mobile */
        .phone-office {
            color: #e74c3c !important;
            text-decoration: none;
            font-weight: 500;
        }
        
        .phone-mobile {
            color: #27ae60 !important;
            text-decoration: none;
            font-weight: 500;
        }
        
        .phone-office:hover, .phone-mobile:hover {
            text-decoration: underline;
        }
        
        /* District treasury styling */
        .district-treasury {
            font-weight: bold;
            color: #27ae60;
            text-transform: uppercase;
        }
        
        /* Treasury name uppercase styling */
        .treasury-name {
            text-transform: uppercase;
        }
        
        /* Table styling */
        .table thead {
            background-color: #5f87c5;
            color: white;
        }
        
        .table-responsive {
            margin-top: 20px;
        }
        
        /* DataTables styling */
        .dataTables_wrapper .dataTables_paginate .paginate_button {
            border-radius: 4px !important;
            margin: 0 2px;
            padding: 6px 12px;
        }
        
        .dataTables_wrapper .dataTables_paginate .paginate_button.current {
            background: #5f87c5 !important;
            color: white !important;
            border: none;
        }
        
        .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
            background: #4a6da7 !important;
            color: white !important;
        }
        
        .dataTables_length, .dataTables_filter {
            margin-bottom: 15px;
        }
        
        .dataTables_filter input {
            border-radius: 4px;
            border: 1px solid #ced4da;
            padding: 6px 10px;
        }
        
        .dataTables_length select {
            border-radius: 4px;
            border: 1px solid #ced4da;
            padding: 6px;
        }
        
        /* Table row styling */
        #dataTable tbody tr.odd {
            background-color: #d7e2ff6e !important;
        }
        
        #dataTable tbody tr.even {
            background-color: white !important;
        }
        
        #dataTable tbody tr:hover {
            background-color: #f1f5ff !important;
        }
        
        /* Remove default striped styling */
        .table-striped tbody tr:nth-of-type(odd) {
            background-color: transparent;
        }
    </style>
</head>

<body class="container py-4" style="background-color: #d7e2ff6e;min-width: 100%;">
    <div class="card">
        <div class="card-header">
            <h5>Treasury Contact Details</h5>
        </div>
        <div class="card-body p-4">
            <div id="loading" class="loading">Loading data ...</div>
            <div id="error" class="error" style="display: none;"></div>
            
            <div class="table-responsive">
                <table id="dataTable" class="table table-striped table-bordered dataTable" style="display: none; width: 100%;">
                    <thead>
                        <tr>
                            <th>SL No</th>
                            <th>Treasury Code</th>
                            <th>Treasury Name</th>
                            <th>Mail Id</th>
                            <th>Phone (Office)</th>
                            <th>Mobile</th>
                            <th>eOffice ID</th>
                        </tr>
                    </thead>
                    <tbody id="tableBody">
                        <!-- Data will be inserted here by JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Google Sheets API configuration
        const spreadsheetId = '18lhExWglVLjILFfwnOgrPnG1hB80tkbcWkxjdsGCqN8';
        const apiKey = 'AIzaSyBAuS3Brpsw5JOJnjNJii1UlFa7ClXf8d4';
        const sheetName = 'All treasuries CRU Mail Id & Phone Number';
        
        // DOM elements
        const loadingElement = document.getElementById('loading');
        const errorElement = document.getElementById('error');
        const tableElement = document.getElementById('dataTable');
        const tableBody = document.getElementById('tableBody');

        // Function to create clickable email link
        function createEmailLink(email) {
            if (!email || email === '-' || email.trim() === '') return '-';
            
            const cleanEmail = email.trim();
            return `<a href="mailto:${cleanEmail}" class="email-link">${cleanEmail}</a>`;
        }

        // Function to create clickable phone link
        function createPhoneLink(phone, isMobile = false) {
            if (!phone || phone === '-' || phone.trim() === '') return '-';
            
            // Clean phone number - remove spaces, dashes, etc.
            const cleanPhone = phone.replace(/[\s\-\(\)]/g, '');
            const className = isMobile ? 'phone-mobile' : 'phone-office';
            
            return `<a href="tel:${cleanPhone}" class="${className}">${phone}</a>`;
        }

        // Function to format treasury name in uppercase
        function formatTreasuryName(name) {
            if (!name || name === '-' || name.trim() === '') return '-';
            return name.toUpperCase();
        }

        // Fetch data from Google Sheets
        async function fetchSheetData() {
            try {
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}/values/${encodeURIComponent(sheetName)}?key=${apiKey}`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                return data.values;
            } catch (error) {
                console.error('Error fetching data:', error);
                errorElement.textContent = `Error loading data: ${error.message}`;
                errorElement.style.display = 'block';
                loadingElement.style.display = 'none';
                return null;
            }
        }

        // Process and display the data
        async function displayData() {
            const data = await fetchSheetData();
            
            if (!data || data.length === 0) {
                errorElement.textContent = 'No data found or error loading data.';
                errorElement.style.display = 'block';
                loadingElement.style.display = 'none';
                return;
            }
            
            // Remove the header row if it exists
            const headers = data[0];
            const rows = data.slice(1);
            
            // Clear loading message
            loadingElement.style.display = 'none';
            
            // Populate the table
            rows.forEach((row, index) => {
                const tr = document.createElement('tr');
                
                // Create cells for each column
                row.forEach((cell, cellIndex) => {
                    const td = document.createElement('td');
                    
                    // Apply special formatting based on column
                    const headerName = headers[cellIndex];
                    
                    if (headerName === 'Mail Id') {
                        td.innerHTML = createEmailLink(cell);
                    } else if (headerName === 'Phone(Office)') {
                        td.innerHTML = createPhoneLink(cell, false);
                    } else if (headerName === 'Mobile') {
                        td.innerHTML = createPhoneLink(cell, true);
                    } else if (headerName === 'Treasury Name') {
                        // Format all treasury names in uppercase
                        const formattedName = formatTreasuryName(cell);
                        td.textContent = formattedName;
                        
                        // Add special styling for district treasuries
                        if (cell && cell.toLowerCase().includes('district treasury')) {
                            td.className = 'district-treasury';
                        } else {
                            td.className = 'treasury-name';
                        }
                    } else {
                        td.textContent = cell || '-';
                    }
                    
                    tr.appendChild(td);
                });
                
                tableBody.appendChild(tr);
            });
            
            // Initialize DataTable
            const table = $('#dataTable').DataTable({
                autoWidth: false,
                paging: true,
                pageLength: 10,
                lengthMenu: [10, 25, 50, 100],
                searching: true,
                ordering: true,
                responsive: true,
                // Disable DataTables default striping
                stripeClasses: ['odd', 'even'],
                initComplete: function() {
                    // Show the table after DataTable initialization
                    tableElement.style.display = 'table';
                }
            });
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', displayData);
    </script>
</body>
</html>
